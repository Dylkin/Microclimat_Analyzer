# Миграция UUID пользователя по умолчанию с версии 0 на версию 5

## Описание изменений

UUID пользователя по умолчанию был изменен с версии 0 (nil UUID) на версию 5 для соответствия стандартам UUID и прохождения валидации.

### Старый UUID (версия 0)
```
00000000-0000-0000-0000-000000000001
```

### Новый UUID (версия 5)
```
4ddace07-1e3a-5ff9-ac81-0183d0e34403
```

UUID версии 5 генерируется детерминированно на основе:
- **Namespace**: DNS namespace UUID (`6ba7b810-9dad-11d1-80b4-00c04fd430c8`)
- **Имя**: Email пользователя (`pavel.dylkin@gmail.com`)

## Измененные файлы

### Backend
1. **`server/scripts/create-default-user.ts`**
   - Добавлен импорт `uuid` библиотеки
   - UUID теперь генерируется динамически через `uuid.v5()`
   - Используется DNS namespace и email для детерминированной генерации

2. **`server/scripts/migrate-default-user-uuid.ts`** (новый файл)
   - Скрипт миграции для обновления существующего пользователя в БД
   - Обновляет все связанные таблицы, которые ссылаются на `users.id`

3. **`server/scripts/test-tender-settings-*.ts`**
   - Обновлены тестовые скрипты для использования нового UUID

### Frontend
1. **`src/contexts/AuthContext.tsx`**
   - Обновлен `defaultUser.id` на новый UUID v5
   - Валидация UUID уже поддерживает версию 5 (0-5)

### Package.json
- Добавлен скрипт `migrate-default-user-uuid` для выполнения миграции

## Выполнение миграции

### Для новых установок
Новый UUID будет автоматически использоваться при создании пользователя по умолчанию:
```bash
npm run create-default-user
```

### Для существующих установок
Выполните миграцию для обновления существующего пользователя:
```bash
npm run migrate-default-user-uuid
```

Скрипт миграции:
- Проверяет наличие пользователя со старым UUID
- Обновляет UUID в таблице `users`
- Обновляет все связанные таблицы:
  - `project_stage_assignments.assigned_by`
  - `qualification_work_schedule.completed_by`
  - И другие таблицы, которые ссылаются на `users.id`

## Валидация UUID

Валидация UUID была обновлена для поддержки версий 0-5:
```typescript
const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
```

Это позволяет принимать:
- Версию 0 (nil UUID) - для обратной совместимости
- Версию 1-4 - стандартные UUID
- Версию 5 - детерминированные UUID на основе namespace и имени

## Зависимости

Добавлена библиотека `uuid` для генерации UUID версии 5:
```bash
npm install uuid @types/uuid
```

## Примечания

- UUID версии 5 детерминирован: один и тот же namespace и имя всегда дают один и тот же UUID
- Это позволяет синхронизировать UUID между фронтендом и бэкендом без необходимости хранения константы
- Миграции в `supabase/migrations` оставлены без изменений, так как они исторические

