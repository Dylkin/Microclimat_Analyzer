# Исправление некорректного отображения количества логгеров (v2)

## Проблема

На странице "Анализ данных" в блоке "Информация об объекте" поле "Логгеров" отображает 0 вместо ожидаемого значения 2, хотя в базе данных есть 2 записи логгеров.

## Диагностика из логов

Из логов видно:
```
LoggerDataService: результат запроса: {data: Array(2), error: null}
DataAnalysis: Загружено логгеров: 0 из 2 записей
```

Это означает, что:
- ✅ **Данные загружаются корректно** - найдено 2 записи в базе данных
- ❌ **Подсчет логгеров работает неправильно** - результат 0 вместо 2

## Причина

Проблема была в неправильном названии поля в функции `loadLoggerCount`:

```tsx
// Неправильно - поле fileName не существует в данных из БД
if (logger.fileName) {
  uniqueLoggers.add(logger.fileName);
}

// Правильно - поле называется file_name в базе данных
if (logger.file_name) {
  uniqueLoggers.add(logger.file_name);
}
```

## Решение

### 1. Исправлено название поля

В функции `loadLoggerCount` в `DataAnalysis.tsx`:

```tsx
// Подсчитываем уникальные логгеры (по имени файла или серийному номеру)
const uniqueLoggers = new Set();
loggerData.forEach(logger => {
  // Используем имя файла как идентификатор логгера
  // В базе данных поле называется file_name, а не fileName
  if (logger.file_name) {
    uniqueLoggers.add(logger.file_name);
  }
});
```

### 2. Добавлено дополнительное логирование

```tsx
console.log('DataAnalysis: Получены данные логгеров:', loggerData);
console.log('DataAnalysis: Структура первой записи:', loggerData[0]);
```

## Структура данных

Данные из таблицы `logger_data_summary` имеют следующую структуру:

```typescript
interface LoggerDataSummary {
  id?: string;
  project_id: string;
  qualification_object_id: string;
  zone_number: number;
  measurement_level: number;
  logger_name: string;
  file_name: string;        // ← Это поле используется для подсчета
  device_type: number;
  device_model: string;
  serial_number: string;
  start_date: Date;
  end_date: Date;
  record_count: number;
  parsing_status: 'processing' | 'completed' | 'error';
  error_message?: string;
  created_at?: Date;
}
```

## Результат

После применения исправления:

1. ✅ **Поле "Логгеров" показывает корректное значение** - 2 вместо 0
2. ✅ **Подсчет основан на уникальных именах файлов** - каждый файл = один логгер
3. ✅ **Добавлено подробное логирование** для диагностики

## Ожидаемые логи

После исправления в консоли браузера вы увидите:

```
DataAnalysis: Получены данные логгеров: [{...}, {...}]
DataAnalysis: Структура первой записи: {file_name: "DL-019!.xls", ...}
DataAnalysis: Загружено логгеров: 2 из 2 записей
```

## Тестирование

Для проверки исправления:

1. Откройте страницу "Анализ данных" для объекта квалификации "ХК-32"
2. Убедитесь, что:
   - **"Точек измерения"** показывает количество зон измерения
   - **"Логгеров"** показывает 2 (количество загруженных файлов логгеров)
3. Проверьте логи в консоли браузера

## Пример исправления

**До исправления:**
- Точек измерения: 1
- Логгеров: 0 ❌ (неправильно)

**После исправления:**
- Точек измерения: 1 ✅ (зоны измерения объекта)
- Логгеров: 2 ✅ (реальное количество загруженных логгеров)

## Дополнительная информация

Логика подсчета логгеров:
1. **Загружаются данные** из таблицы `logger_data_summary`
2. **Подсчитываются уникальные имена файлов** в поле `file_name`
3. **Каждый уникальный файл** считается как один логгер
4. **Результат отображается** в поле "Логгеров"

Это обеспечивает корректный подсчет даже если один логгер загружен несколько раз или имеет несколько записей в базе данных.



















