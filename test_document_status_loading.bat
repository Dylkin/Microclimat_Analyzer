@echo off
echo ========================================
echo Тест загрузки статусов и комментариев документов
echo ========================================
echo.
echo Проверяемые функции:
echo 1. Загрузка комментариев при повторном открытии проекта
echo 2. Загрузка статусов согласования из базы данных
echo 3. Отображение истории согласований
echo 4. Сохранение данных между сессиями
echo.
echo Инструкции для тестирования:
echo.
echo 1. Убедитесь, что выполнены SQL команды из create_document_approval_tables.sql
echo 2. Запустите приложение: start_with_document_status_fix.bat
echo 3. Авторизуйтесь в приложении
echo 4. Перейдите на страницу "Согласование договора"
echo.
echo Тест 1 - Добавление комментариев:
echo - Откройте блок "Согласование документов"
echo - Добавьте комментарии к коммерческому предложению
echo - Добавьте комментарии к договору
echo - Проверьте, что комментарии отображаются
echo.
echo Тест 2 - Согласование документов:
echo - Согласуйте коммерческое предложение (нажмите "Согласовано")
echo - Отклоните договор (нажмите "Отклонить")
echo - Проверьте, что статусы изменились
echo - Проверьте, что история согласований отображается
echo.
echo Тест 3 - Повторное открытие проекта:
echo - Обновите страницу (F5)
echo - Или перезапустите приложение
echo - Перейдите на страницу "Согласование договора"
echo - Проверьте, что:
echo   * Комментарии отображаются
echo   * Статусы согласования сохранены
echo   * История согласований отображается
echo.
echo Тест 4 - Проверка в консоли браузера:
echo - Откройте консоль браузера (F12)
echo - При загрузке страницы должны появиться логи:
echo   * "Загрузка комментариев для документа: [ID]"
echo   * "Загружены комментарии: [данные]"
echo   * "Загрузка истории согласований для документа: [ID]"
echo   * "Загружена история согласований: [данные]"
echo.
echo Тест 5 - Проверка в базе данных:
echo - Откройте Supabase Dashboard
echo - Перейдите в Table Editor
echo - Проверьте таблицы:
echo   * document_comments - должны быть комментарии
echo   * document_approvals - должны быть записи согласований
echo.
echo SQL запросы для проверки:
echo.
echo -- Просмотр комментариев
echo SELECT 
echo   document_id,
echo   user_name,
echo   comment,
echo   created_at
echo FROM document_comments 
echo ORDER BY created_at DESC;
echo.
echo -- Просмотр согласований
echo SELECT 
echo   document_id,
echo   user_name,
echo   status,
echo   comment,
echo   created_at
echo FROM document_approvals 
echo ORDER BY created_at DESC;
echo.
echo -- Статистика по статусам
echo SELECT 
echo   status,
echo   COUNT(*) as count
echo FROM document_approvals 
echo GROUP BY status;
echo.
echo Ожидаемые результаты:
echo - Комментарии загружаются и отображаются при повторном открытии
echo - Статусы согласования загружаются из базы данных
echo - История согласований отображается полностью
echo - Данные сохраняются между сессиями
echo - В консоли браузера видны логи загрузки данных
echo.
echo Если тесты проходят успешно:
echo ✅ Комментарии отображаются при повторном открытии проекта
echo ✅ Статусы согласования загружаются из базы данных
echo ✅ История согласований отображается полностью
echo ✅ Данные сохраняются между сессиями
echo ✅ Проблема с загрузкой данных решена
echo.
pause























