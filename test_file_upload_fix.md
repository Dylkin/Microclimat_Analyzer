# Тестирование исправления загрузки файла "План объекта"

## Проблема
Файл "План объекта" не сохранялся для новых объектов квалификации, так как логика загрузки файла работала только для существующих объектов (когда `initialData.id` был определен).

## Исправления

### 1. QualificationObjectForm.tsx
- ✅ Обновлен интерфейс `QualificationObjectFormProps` - `onSubmit` теперь возвращает `Promise<QualificationObject>`
- ✅ Исправлена логика в `handleSubmit` - теперь получаем ID сохраненного объекта из результата `onSubmit`
- ✅ Файлы загружаются после сохранения объекта с правильным ID

### 2. ContractorDirectory.tsx
- ✅ Обновлена функция `handleSaveQualificationObject` - теперь возвращает сохраненный объект
- ✅ Добавлена обработка ошибок с пробрасыванием

### 3. QualificationObjectsTable.tsx
- ✅ Обновлен интерфейс `QualificationObjectsTableProps` - `onSaveQualificationObject` возвращает `Promise<QualificationObject>`
- ✅ Исправлен вызов `onSaveQualificationObject` для возврата результата

### 4. QualificationObjectsCRUD.tsx
- ✅ Обновлена функция `handleUpdate` - теперь возвращает сохраненный объект
- ✅ Добавлена обработка ошибок с пробрасыванием

### 5. Тесты
- ✅ Обновлены тесты для соответствия новому интерфейсу

## Логика работы после исправления

1. Пользователь заполняет форму объекта квалификации и выбирает файл "План объекта"
2. При нажатии "Сохранить" вызывается `handleSubmit`
3. Сначала сохраняется объект квалификации через `onSubmit`
4. `onSubmit` возвращает сохраненный объект с ID из базы данных
5. Получаем ID сохраненного объекта: `const objectId = savedObject?.id || finalFormData.id`
6. Загружаем файл "План объекта" с правильным ID: `await qualificationObjectService.uploadPlanFile(objectId, planFile)`
7. Файл успешно сохраняется в Supabase Storage и URL записывается в базу данных

## Тестирование

### Сценарий 1: Создание нового объекта с файлом
1. Открыть "Справочник контрагентов"
2. Выбрать контрагента и нажать "Редактировать"
3. Нажать "Добавить объект"
4. Заполнить форму объекта квалификации
5. Выбрать файл "План объекта" (JPG, PNG, PDF, TIFF, BMP)
6. Нажать "Сохранить"
7. ✅ Объект должен сохраниться с файлом

### Сценарий 2: Редактирование существующего объекта с новым файлом
1. Открыть существующий объект квалификации
2. Выбрать новый файл "План объекта"
3. Нажать "Сохранить"
4. ✅ Файл должен обновиться

### Сценарий 3: Проверка в базе данных
```sql
-- Проверить, что файл сохранился
SELECT id, name, plan_file_url, plan_file_name 
FROM qualification_objects 
WHERE plan_file_url IS NOT NULL;
```

## Ожидаемый результат
- ✅ Файлы "План объекта" сохраняются для новых объектов квалификации
- ✅ Файлы "План объекта" обновляются для существующих объектов
- ✅ URL файлов корректно записывается в базу данных
- ✅ Файлы доступны для просмотра через ссылки в интерфейсе























