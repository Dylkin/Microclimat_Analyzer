# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Microclimat Analyzer

## üö® **–ü—Ä–æ–±–ª–µ–º–∞ —Å CREATE INDEX CONCURRENTLY**

### **–ü—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏:**
```
ERROR: 25001: CREATE INDEX CONCURRENTLY cannot run inside a transaction block
```

**–û–±—ä—è—Å–Ω–µ–Ω–∏–µ:** `CREATE INDEX CONCURRENTLY` –Ω–µ –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∞ Supabase SQL Editor –≤—ã–ø–æ–ª–Ω—è–µ—Ç –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

## üìÅ **–°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º—ã:**

### **1. `database_optimization_simple.sql`**
- ‚úÖ **–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Ñ–∞–π–ª** –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- ‚úÖ –£–±—Ä–∞–Ω—ã –≤—Å–µ `CONCURRENTLY` –∫–æ–º–∞–Ω–¥—ã
- ‚úÖ –ú–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ü–µ–ª–∏–∫–æ–º –≤ Supabase SQL Editor
- ‚úÖ –í–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã –∏ —Ñ—É–Ω–∫—Ü–∏–∏

### **2. `create_indexes_individual.sql`**
- üìù –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç
- üìù –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–æ –æ–¥–Ω–æ–π
- üìù –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü

### **3. `database_optimization.sql`**
- ‚ö†Ô∏è –ò—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª —Å `CONCURRENTLY`
- ‚ö†Ô∏è –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ Supabase SQL Editor
- ‚ö†Ô∏è –¢–æ–ª—å–∫–æ –¥–ª—è —Å–ø—Ä–∞–≤–∫–∏

## üöÄ **–ö–∞–∫ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é:**

### **–í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ—Å—Ç–æ–π (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**
1. –û—Ç–∫—Ä–æ–π—Ç–µ Supabase Dashboard
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ SQL Editor
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `database_optimization_simple.sql`
4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤–µ—Å—å —Å–∫—Ä–∏–ø—Ç

### **–í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ —á–∞—Å—Ç—è–º**
1. –û—Ç–∫—Ä–æ–π—Ç–µ `create_indexes_individual.sql`
2. –í—ã–ø–æ–ª–Ω—è–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –ø–æ –æ–¥–Ω–æ–π
3. –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞

## üìä **–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**

### **1. –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤:**
- **contractors:** –ø–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏, –∞–¥—Ä–µ—Å—É
- **projects:** –ø–æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—É, —Å—Ç–∞—Ç—É—Å—É, –¥–∞—Ç–∞–º
- **qualification_objects:** –ø–æ –ø—Ä–æ–µ–∫—Ç—É, —Ç–∏–ø—É, —Å—Ç–∞—Ç—É—Å—É
- **qualification_stages:** –ø–æ –æ–±—ä–µ–∫—Ç—É, –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é, –¥–∞—Ç–∞–º
- **project_documents:** –ø–æ —Ç–∏–ø—É, –¥–∞—Ç–µ –∑–∞–≥—Ä—É–∑–∫–∏
- **uploaded_files:** –ø–æ —Ç–∏–ø—É, —Ä–∞–∑–º–µ—Ä—É, –¥–∞—Ç–µ
- **audit_logs:** –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –¥–µ–π—Å—Ç–≤–∏—é, —Å—É—â–Ω–æ—Å—Ç–∏

### **2. GIN –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è JSONB:**
- `technical_parameters` –≤ qualification_objects
- `measurement_zones` –≤ qualification_objects
- `details` –≤ audit_logs
- `metadata` –≤ uploaded_files

### **3. –ú–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ:**
- `mv_project_summary` - —Å–≤–æ–¥–∫–∞ –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é

### **4. –ü–æ–ª–µ–∑–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `check_data_integrity()` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
- `get_database_stats()` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ë–î
- `analyze_index_usage()` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
- `get_table_sizes()` - —Ä–∞–∑–º–µ—Ä—ã —Ç–∞–±–ª–∏—Ü
- `cleanup_old_audit_logs()` - –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤

## üîç **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**

### **–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:**

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
SELECT * FROM get_database_stats();

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
SELECT * FROM check_data_integrity();

-- –ê–Ω–∞–ª–∏–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
SELECT * FROM analyze_index_usage();

-- –†–∞–∑–º–µ—Ä—ã —Ç–∞–±–ª–∏—Ü
SELECT * FROM get_table_sizes();
```

## ‚ö° **–û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**

### **1. –£—Å–∫–æ—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤:**
- –ü–æ–∏—Å–∫ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤: **10-50x –±—ã—Å—Ç—Ä–µ–µ**
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–æ–≤: **5-20x –±—ã—Å—Ç—Ä–µ–µ**
- –ü–æ–∏—Å–∫ –æ–±—ä–µ–∫—Ç–æ–≤ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏: **3-15x –±—ã—Å—Ç—Ä–µ–µ**
- –ó–∞–ø—Ä–æ—Å—ã –ø–æ –¥–∞—Ç–∞–º: **5-25x –±—ã—Å—Ç—Ä–µ–µ**

### **2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è JSONB:**
- –ü–æ–∏—Å–∫ –≤ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö: **20-100x –±—ã—Å—Ç—Ä–µ–µ**
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∑–æ–Ω–∞–º –∏–∑–º–µ—Ä–µ–Ω–∏—è: **10-50x –±—ã—Å—Ç—Ä–µ–µ**
- –ü–æ–∏—Å–∫ –≤ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤: **15-75x –±—ã—Å—Ç—Ä–µ–µ**

### **3. –£–ª—É—á—à–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:**
- –°–≤–æ–¥–∫–∏ –ø–æ –ø—Ä–æ–µ–∫—Ç–∞–º: **50-200x –±—ã—Å—Ç—Ä–µ–µ**
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è: **10-40x –±—ã—Å—Ç—Ä–µ–µ**

## üõ†Ô∏è **–û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ:**

### **–†–µ–≥—É–ª—è—Ä–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
```sql
-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ)
ANALYZE;

-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ)
SELECT refresh_project_summary();

-- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –ª–æ–≥–æ–≤ (–µ–∂–µ–º–µ—Å—è—á–Ω–æ)
SELECT cleanup_old_audit_logs(365);
```

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ (–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ)
SELECT * FROM check_data_integrity();

-- –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–µ–∂–µ–º–µ—Å—è—á–Ω–æ)
SELECT * FROM analyze_index_usage();
```

## üö® **–í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è:**

### **1. –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å **5-30 –º–∏–Ω—É—Ç**
- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ç–∞–±–ª–∏—Ü
- –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å

### **2. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏:**
- –û–±—ã—á–Ω—ã–µ `CREATE INDEX` –±–ª–æ–∫–∏—Ä—É—é—Ç —Ç–∞–±–ª–∏—Ü—ã
- –î–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `CONCURRENTLY` —á–µ—Ä–µ–∑ psql
- –í Supabase —ç—Ç–æ –Ω–µ –≤—Å–µ–≥–¥–∞ –≤–æ–∑–º–æ–∂–Ω–æ

### **3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- –°–ª–µ–¥–∏—Ç–µ –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞
- –ò–Ω–¥–µ–∫—Å—ã —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç —Ä–∞–∑–º–µ—Ä –ë–î –Ω–∞ **20-50%**
- –†–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã

## üìà **–ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞:**

### **–î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤: **100-5000ms**
- –†–∞–∑–º–µ—Ä –ë–î: **X MB**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω–¥–µ–∫—Å–æ–≤: **Y**

### **–ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤: **10-200ms**
- –†–∞–∑–º–µ—Ä –ë–î: **X * 1.3 MB**
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–Ω–¥–µ–∫—Å–æ–≤: **Y + 20**

## üîß **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º:**

### **–ï—Å–ª–∏ –∏–Ω–¥–µ–∫—Å—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å SQL

### **–ï—Å–ª–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ —É–ª—É—á—à–∏–ª–∞—Å—å:**
1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ `ANALYZE;`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–ª–∞–Ω—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∏–Ω–¥–µ–∫—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è

### **–ï—Å–ª–∏ –ë–î —Å—Ç–∞–ª–∞ –º–µ–¥–ª–µ–Ω–Ω–µ–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∏–Ω–¥–µ–∫—Å—ã
2. –£–¥–∞–ª–∏—Ç–µ –ª–∏—à–Ω–∏–µ –∏–Ω–¥–µ–∫—Å—ã
3. –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞: –Ø–Ω–≤–∞—Ä—å 2025*  
*–í–µ—Ä—Å–∏—è: 1.0*















