# Исправление отображения реквизитов договора на странице "Анализ данных"

## Проблема

На странице "Анализ данных" в блоке "Информация о договоре" поля "№ договора" и "Дата договора" не содержат данные из блока "Согласование документов" → "Реквизиты договора". Также нужно изменить название блока с "Информация о договоре" на "Реквизиты договора".

## Решение

### 1. Обновлен интерфейс TimeSeriesAnalyzerProps

Добавлен проп `project` для передачи данных договора:

```tsx
interface TimeSeriesAnalyzerProps {
  files: UploadedFile[];
  onBack?: () => void;
  qualificationObjectId?: string;
  projectId?: string;
  project?: {
    contractNumber?: string;
    contractDate?: string;
  };
}
```

### 2. Добавлена инициализация полей договора

В `TimeSeriesAnalyzer` добавлен `useEffect` для автоматического заполнения полей данными из проекта:

```tsx
// Инициализация полей договора данными из проекта
useEffect(() => {
  if (project) {
    console.log('TimeSeriesAnalyzer: Инициализация полей договора данными из проекта:', project);
    setContractFields(prev => ({
      ...prev,
      contractNumber: project.contractNumber || '',
      contractDate: project.contractDate ? new Date(project.contractDate).toISOString().split('T')[0] : ''
    }));
  }
}, [project]);
```

### 3. Изменен заголовок блока

```tsx
// Было
<label className="block text-sm font-medium text-gray-700 mb-2">Информация о договоре</label>

// Стало
<label className="block text-sm font-medium text-gray-700 mb-2">Реквизиты договора</label>
```

### 4. Обновлена передача данных из DataAnalysis

В `DataAnalysis.tsx` добавлена передача данных проекта в `TimeSeriesAnalyzer`:

```tsx
<TimeSeriesAnalyzer 
  files={[]} // Будет загружено из базы данных
  qualificationObjectId={selectedQualificationObject.id}
  projectId={fullProject?.id || project.id}
  project={{
    contractNumber: fullProject?.contractNumber,
    contractDate: fullProject?.contractDate
  }}
/>
```

## Результат

После применения исправлений:

1. ✅ **Заголовок изменен** с "Информация о договоре" на "Реквизиты договора"
2. ✅ **Поле "№ договора"** автоматически заполняется данными из проекта
3. ✅ **Поле "Дата договора"** автоматически заполняется данными из проекта
4. ✅ **Данные синхронизированы** с блоком "Согласование документов"
5. ✅ **Добавлено логирование** для диагностики

## Логика работы

1. **При загрузке страницы "Анализ данных"**:
   - `DataAnalysis` загружает полную информацию о проекте
   - Данные проекта передаются в `TimeSeriesAnalyzer`

2. **В `TimeSeriesAnalyzer`**:
   - `useEffect` отслеживает изменения в пропе `project`
   - При получении данных проекта автоматически заполняет поля `contractFields`
   - Поля "№ договора" и "Дата договора" отображают актуальные данные

3. **Форматирование даты**:
   - Дата конвертируется из формата проекта в формат `YYYY-MM-DD` для поля `input[type="date"]`

## Диагностика

В консоли браузера вы увидите логи:

```
TimeSeriesAnalyzer: Инициализация полей договора данными из проекта: {
  contractNumber: "ВР-15-25",
  contractDate: "2025-10-01T00:00:00.000Z"
}
```

## Тестирование

Для проверки исправления:

1. Откройте страницу "Согласование договора"
2. Убедитесь, что в блоке "Реквизиты договора" заполнены:
   - № договора: "ВР-15-25"
   - Дата договора: "2025-10-01"
3. Перейдите на страницу "Анализ данных"
4. Убедитесь, что в блоке "Реквизиты договора" отображаются те же данные

## Пример

**До исправления:**
- Заголовок: "Информация о договоре"
- № договора: (пустое поле)
- Дата договора: (пустое поле)

**После исправления:**
- Заголовок: "Реквизиты договора" ✅
- № договора: "ВР-15-25" ✅
- Дата договора: "2025-10-01" ✅

## Дополнительная информация

- Поля остаются редактируемыми - пользователь может изменить значения при необходимости
- Данные автоматически обновляются при изменении проекта
- Логирование помогает отследить процесс инициализации полей



















