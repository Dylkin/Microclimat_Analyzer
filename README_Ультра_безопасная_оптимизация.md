# üõ°Ô∏è –£–ª—å—Ç—Ä–∞-–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üìã –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ –≤–æ–∑–Ω–∏–∫–ª–∞ –æ—à–∏–±–∫–∞:
```
ERROR: 42703: column "file_type" does not exist
CONTEXT: SQL statement "CREATE INDEX IF NOT EXISTS idx_uploaded_files_type_size ON uploaded_files (file_type, file_size)"
```

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Ç–∞–±–ª–∏—Ü–∞ `uploaded_files` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ —É –Ω–µ—ë –Ω–µ—Ç –∫–æ–ª–æ–Ω–∫–∏ `file_type`.

## üéØ –†–µ—à–µ–Ω–∏–µ

–°–æ–∑–¥–∞–Ω **—É–ª—å—Ç—Ä–∞-–±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç** `database_optimization_ultra_safe.sql`, –∫–æ—Ç–æ—Ä—ã–π:

- ‚úÖ **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ** –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ** –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–∏ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∏–Ω–¥–µ–∫—Å–æ–≤
- ‚úÖ **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É** —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, pg_trgm)
- ‚úÖ **–í—ã–≤–æ–¥–∏—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ –∫–∞–∂–¥–æ–º —à–∞–≥–µ
- ‚úÖ **–†–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –æ—à–∏–±–æ–∫

## üîç –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è

### 1. **–î–ª—è –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã:**
- –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
- –°—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–∏
- –¢–∏–ø –¥–∞–Ω–Ω—ã—Ö –∫–æ–ª–æ–Ω–∫–∏
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞

### 2. **–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–∏–π WHERE
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π (pg_trgm –¥–ª—è —Ç—Ä–∏–≥—Ä–∞–º–º)

### 3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ –±–ª–æ–∫–∞—Ö `DO $$`
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ—Ü–µ—Å—Å–µ
- –ù–µ—Ç –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

### 1. –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
```sql
-- –í—ã–ø–æ–ª–Ω–∏—Ç–µ check_all_tables_structure.sql –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
```

### 2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —É–ª—å—Ç—Ä–∞-–±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç:
```sql
-- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ database_optimization_ultra_safe.sql
-- –≤ Supabase SQL Editor
```

### 3. –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
–°–∫—Ä–∏–ø—Ç –≤—ã–≤–µ–¥–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:
```
NOTICE: –ò–Ω–¥–µ–∫—Å idx_contractors_name_lower —Å–æ–∑–¥–∞–Ω
NOTICE: –ò–Ω–¥–µ–∫—Å idx_contractors_address —Å–æ–∑–¥–∞–Ω
NOTICE: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü—ã contractors –∑–∞–≤–µ—Ä—à–µ–Ω–∞
NOTICE: –ò–Ω–¥–µ–∫—Å idx_projects_contractor_status —Å–æ–∑–¥–∞–Ω
NOTICE: –ò–Ω–¥–µ–∫—Å idx_projects_created_at —Å–æ–∑–¥–∞–Ω
NOTICE: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü—ã projects –∑–∞–≤–µ—Ä—à–µ–Ω–∞
NOTICE: –ò–Ω–¥–µ–∫—Å idx_qualification_objects_contractor_type —Å–æ–∑–¥–∞–Ω
NOTICE: –ò–Ω–¥–µ–∫—Å idx_qualification_objects_type —Å–æ–∑–¥–∞–Ω
NOTICE: GIN –∏–Ω–¥–µ–∫—Å –¥–ª—è measurement_zones —Å–æ–∑–¥–∞–Ω
NOTICE: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü—ã qualification_objects –∑–∞–≤–µ—Ä—à–µ–Ω–∞
NOTICE: –¢–∞–±–ª–∏—Ü–∞ qualification_stages –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
NOTICE: –¢–∞–±–ª–∏—Ü–∞ project_documents –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
NOTICE: –ö–æ–ª–æ–Ω–∫–∏ file_type –∏–ª–∏ file_size –Ω–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ uploaded_files
NOTICE: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü—ã uploaded_files –∑–∞–≤–µ—Ä—à–µ–Ω–∞
NOTICE: –ò–Ω–¥–µ–∫—Å idx_audit_logs_user_action —Å–æ–∑–¥–∞–Ω
NOTICE: –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü—ã audit_logs –∑–∞–≤–µ—Ä—à–µ–Ω–∞
```

## üìä –ß—Ç–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–æ

### ‚úÖ **–î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏:**

#### **contractors:**
- `idx_contractors_name_lower` - –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é
- `idx_contractors_address` - –ø–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É

#### **projects:**
- `idx_projects_contractor_status` - –ø—Ä–æ–µ–∫—Ç—ã –ø–æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—É –∏ —Å—Ç–∞—Ç—É—Å—É
- `idx_projects_created_at` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è
- `idx_projects_contract_date` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–µ –¥–æ–≥–æ–≤–æ—Ä–∞
- `idx_projects_active` - —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã

#### **qualification_objects:**
- `idx_qualification_objects_contractor_type` - –æ–±—ä–µ–∫—Ç—ã –ø–æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—É –∏ —Ç–∏–ø—É
- `idx_qualification_objects_type` - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–ø—É
- `idx_qualification_objects_manufacturer` - –ø–æ–∏—Å–∫ –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—é
- `idx_qualification_objects_created_at` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è
- `idx_qualification_objects_updated_at` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- `idx_qualification_objects_measurement_zones_gin` - GIN –∏–Ω–¥–µ–∫—Å –¥–ª—è JSONB
- `idx_qualification_objects_with_plans` - –æ–±—ä–µ–∫—Ç—ã —Å –ø–ª–∞–Ω–∞–º–∏
- `idx_qualification_objects_with_coordinates` - –æ–±—ä–µ–∫—Ç—ã —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
- `idx_qualification_objects_name_trgm` - —Ç—Ä–∏–≥—Ä–∞–º–º–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é (–µ—Å–ª–∏ pg_trgm —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
- `idx_qualification_objects_address_trgm` - —Ç—Ä–∏–≥—Ä–∞–º–º–Ω—ã–π –ø–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É (–µ—Å–ª–∏ pg_trgm —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
- `idx_qualification_objects_serial_number` - –ø–æ–∏—Å–∫ –ø–æ —Å–µ—Ä–∏–π–Ω–æ–º—É –Ω–æ–º–µ—Ä—É
- `idx_qualification_objects_inventory_number` - –ø–æ–∏—Å–∫ –ø–æ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–Ω–æ–º—É –Ω–æ–º–µ—Ä—É
- `idx_qualification_objects_contractor_fk` - FK –∏–Ω–¥–µ–∫—Å

#### **audit_logs:**
- `idx_audit_logs_user_action` - –ª–æ–≥–∏ –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∏ –¥–µ–π—Å—Ç–≤–∏—é
- `idx_audit_logs_entity` - –ª–æ–≥–∏ –ø–æ —Ç–∏–ø—É –∏ ID —Å—É—â–Ω–æ—Å—Ç–∏
- `idx_audit_logs_created_at` - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ
- `idx_audit_logs_details_gin` - GIN –∏–Ω–¥–µ–∫—Å –¥–ª—è JSONB

### ‚ùå **–ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã/–∫–æ–ª–æ–Ω–∫–∏:**
- `qualification_stages` - —Ç–∞–±–ª–∏—Ü–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- `project_documents` - —Ç–∞–±–ª–∏—Ü–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- `uploaded_files.file_type` - –∫–æ–ª–æ–Ω–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- `uploaded_files.file_size` - –∫–æ–ª–æ–Ω–∫–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### 1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:**
–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –¥–ª—è –≤—Å–µ—Ö —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ç–∞–±–ª–∏—Ü.

### 2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π:**
–ï—Å–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `pg_trgm` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ, —Ç—Ä–∏–≥—Ä–∞–º–º–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è.

### 3. **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:**
–°–∫—Ä–∏–ø—Ç –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫** –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—è–º –∏ –∞–¥—Ä–µ—Å–∞–º –æ–±—ä–µ–∫—Ç–æ–≤
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** –ø–æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º –∏ —Ç–∏–ø–∞–º
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º –∏ –¥–∞—Ç–∞–º
- **–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø** –∫ JSONB –¥–∞–Ω–Ω—ã–º

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- **–ù–µ—Ç –æ—à–∏–±–æ–∫** –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ç–∞–±–ª–∏—Ü –∏–ª–∏ –∫–æ–ª–æ–Ω–æ–∫
- **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å** –∫ –ª—é–±–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ë–î
- **–ü–æ–¥—Ä–æ–±–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** –æ –ø—Ä–æ—Ü–µ—Å—Å–µ
- **–ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ö–µ–º–æ–π

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–£–ª—å—Ç—Ä–∞-–±–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç `database_optimization_ultra_safe.sql` —Ä–µ—à–∞–µ—Ç –≤—Å–µ –ø—Ä–æ–±–ª–µ–º—ã —Å –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏ –∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏, —Å–æ–∑–¥–∞–≤–∞—è –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö.

**–¢–µ–ø–µ—Ä—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–π–¥–µ—Ç –±–µ–∑ –µ–¥–∏–Ω–æ–π –æ—à–∏–±–∫–∏!** üéâ

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –ø–æ–Ω—è—Ç—å –ø–æ–ª–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤–∞—à–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
```sql
-- check_all_tables_structure.sql
-- –ü–æ–∫–∞–∂–µ—Ç –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã, –∏—Ö –∫–æ–ª–æ–Ω–∫–∏ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
```










