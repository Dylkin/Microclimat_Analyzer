# Добавление полей "Дата договора" и "№ договора"

## Описание изменений

В блок "Договор" на странице "Согласование договора" добавлены два новых поля:
- **№ договора** - текстовое поле для ввода номера договора
- **Дата договора** - поле выбора даты для указания даты подписания договора

## Файлы изменений

### 1. База данных
- `supabase/migrations/20250101190000_add_contract_date.sql` - миграция для добавления поля `contract_date` в таблицу `projects`

### 2. Типы данных
- `src/types/Project.ts` - добавлено поле `contractDate?: Date` в интерфейс `Project` и `UpdateProjectData`

### 3. Сервисы
- `src/utils/projectService.ts` - обновлен для работы с полем `contract_date`:
  - Добавлено поле в `DatabaseProject` интерфейс
  - Обновлено преобразование данных из базы в объект `Project`
  - Добавлена поддержка обновления поля `contractDate` в методе `updateProject`

### 4. Компоненты
- `src/components/contract/ContractFields.tsx` - новый компонент для редактирования полей договора
- `src/components/contract/DocumentApproval.tsx` - интегрирован компонент `ContractFields`
- `src/components/ContractNegotiation.tsx` - обновлен для поддержки редактирования полей договора

## Функциональность

### Компонент ContractFields
- **Режим просмотра**: Отображает текущие значения полей договора
- **Режим редактирования**: Позволяет изменить значения полей
- **Автосохранение**: Изменения сохраняются в базу данных при нажатии "Сохранить"
- **Валидация**: Обработка ошибок при сохранении

### Интеграция
- Поля договора отображаются в блоке "Согласование документов" после блока "Договор"
- Доступны для редактирования только при наличии проекта
- Изменения автоматически обновляют локальное состояние проекта

## Использование

1. **Просмотр полей**: Поля отображаются в режиме просмотра с кнопкой "Редактировать"
2. **Редактирование**: Нажмите "Редактировать" для входа в режим редактирования
3. **Сохранение**: Заполните поля и нажмите "Сохранить"
4. **Отмена**: Нажмите "Отмена" для возврата к исходным значениям

## Структура данных

### В базе данных (таблица projects)
```sql
contract_number text,        -- Номер договора (уже существовал)
contract_date date          -- Дата договора (новое поле)
```

### В TypeScript (интерфейс Project)
```typescript
interface Project {
  // ... другие поля
  contractNumber?: string;   // Номер договора
  contractDate?: Date;       // Дата договора
  // ... другие поля
}
```

## Миграция базы данных

Для применения изменений выполните миграцию:

```sql
-- Выполнить в Supabase SQL Editor
ALTER TABLE public.projects 
ADD COLUMN IF NOT EXISTS contract_date date;

COMMENT ON COLUMN public.projects.contract_date IS 'Дата подписания договора';
```

## Тестирование

1. Откройте страницу "Согласование договора"
2. Найдите блок "Поля договора" в разделе "Согласование документов"
3. Нажмите "Редактировать" для изменения полей
4. Заполните поля и сохраните изменения
5. Проверьте, что данные сохранились и отображаются корректно

## Примечания

- Поле `contract_number` уже существовало в базе данных
- Поле `contract_date` добавлено как новое
- Оба поля являются опциональными (nullable)
- Изменения сохраняются в реальном времени в базу данных
- Компонент поддерживает обработку ошибок и состояния загрузки



















