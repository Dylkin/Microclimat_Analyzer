# üöÄ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

## üìã –û–±–∑–æ—Ä

–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `database_optimization_correct.sql` –Ω–∞ –æ—Å–Ω–æ–≤–µ **—Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** —Ç–∞–±–ª–∏—Ü—ã `qualification_objects`, –ø–æ–ª—É—á–µ–Ω–Ω–æ–π –∏–∑ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.

## üîç –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã qualification_objects

### ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏:
- `id` (uuid) - –ø–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á
- `contractor_id` (uuid) - —Å–≤—è–∑—å —Å –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º–∏
- `type` (text) - —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞ (–ø–æ–º–µ—â–µ–Ω–∏–µ, —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫, –º–æ—Ä–æ–∑–∏–ª—å–Ω–∏–∫)
- `name` (text) - –Ω–∞–∑–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
- `climate_system` (text) - –∫–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–∏—Å—Ç–µ–º–∞
- `plan_file_url` (text) - URL –ø–ª–∞–Ω–∞ –æ–±—ä–µ–∫—Ç–∞
- `plan_file_name` (text) - –∏–º—è —Ñ–∞–π–ª–∞ –ø–ª–∞–Ω–∞
- `address` (text) - –∞–¥—Ä–µ—Å
- `latitude`, `longitude` (numeric) - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
- `geocoded_at` (timestamptz) - –≤—Ä–µ–º—è –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
- `area` (text) - –ø–ª–æ—â–∞–¥—å
- `vin` (text) - VIN –Ω–æ–º–µ—Ä
- `registration_number` (text) - —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –Ω–æ–º–µ—Ä
- `body_volume` (numeric) - –æ–±—ä–µ–º –∫—É–∑–æ–≤–∞
- `inventory_number` (text) - –∏–Ω–≤–µ–Ω—Ç–∞—Ä–Ω—ã–π –Ω–æ–º–µ—Ä
- `chamber_volume` (numeric) - –æ–±—ä–µ–º –∫–∞–º–µ—Ä—ã
- `serial_number` (text) - —Å–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä
- `created_at`, `updated_at` (timestamptz) - –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
- `test_data_file_url` (text) - URL —Ñ–∞–π–ª–∞ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø—ã—Ç–∞–Ω–∏–π
- `test_data_file_name` (text) - –∏–º—è —Ñ–∞–π–ª–∞ –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø—ã—Ç–∞–Ω–∏–π
- `manufacturer` (text) - –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å
- `measurement_zones` (jsonb) - –∑–æ–Ω—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è
- `shelf_count` (integer) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–æ–∫

### ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏:
- `project_id` - –Ω–µ—Ç –ø—Ä—è–º–æ–π —Å–≤—è–∑–∏ —Å –ø—Ä–æ–µ–∫—Ç–∞–º–∏
- `overall_status` - –Ω–µ—Ç –æ–±—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
- `overall_progress` - –Ω–µ—Ç –æ–±—â–µ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- `current_stage_id` - –Ω–µ—Ç —Ç–µ–∫—É—â–µ–≥–æ —ç—Ç–∞–ø–∞
- `technical_parameters` - –Ω–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

## üéØ –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã

### 1. **–û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
- `idx_contractors_name_lower` - –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–æ–≤
- `idx_projects_contractor_status` - –ø—Ä–æ–µ–∫—Ç—ã –ø–æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—É –∏ —Å—Ç–∞—Ç—É—Å—É
- `idx_qualification_objects_contractor_type` - –æ–±—ä–µ–∫—Ç—ã –ø–æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç—É –∏ —Ç–∏–ø—É
- `idx_qualification_objects_manufacturer` - –æ–±—ä–µ–∫—Ç—ã –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—é

### 2. **JSONB –∏–Ω–¥–µ–∫—Å—ã:**
- `idx_qualification_objects_measurement_zones_gin` - –¥–ª—è –∑–æ–Ω –∏–∑–º–µ—Ä–µ–Ω–∏—è
- `idx_audit_logs_details_gin` - –¥–ª—è –¥–µ—Ç–∞–ª–µ–π –∞—É–¥–∏—Ç–∞

### 3. **–ß–∞—Å—Ç–∏—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã:**
- `idx_projects_active` - —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã
- `idx_qualification_objects_with_plans` - –æ–±—ä–µ–∫—Ç—ã —Å –ø–ª–∞–Ω–∞–º–∏
- `idx_qualification_objects_with_coordinates` - –æ–±—ä–µ–∫—Ç—ã —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏

### 4. **–ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø–æ–∏—Å–∫–∞:**
- `idx_qualification_objects_name_trgm` - –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é (trigram)
- `idx_qualification_objects_address_trgm` - –ø–æ–∏—Å–∫ –ø–æ –∞–¥—Ä–µ—Å—É (trigram)
- `idx_qualification_objects_serial_number` - –ø–æ–∏—Å–∫ –ø–æ —Å–µ—Ä–∏–π–Ω–æ–º—É –Ω–æ–º–µ—Ä—É
- `idx_qualification_objects_inventory_number` - –ø–æ–∏—Å–∫ –ø–æ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–Ω–æ–º—É –Ω–æ–º–µ—Ä—É

### 5. **–ò–Ω–¥–µ–∫—Å—ã –¥–ª—è —Å–≤—è–∑–µ–π:**
- `idx_qualification_objects_contractor_fk` - —Å–≤—è–∑—å —Å –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º–∏
- `idx_qualification_stages_object_fk` - —Å–≤—è–∑—å —Å —ç—Ç–∞–ø–∞–º–∏
- `idx_project_documents_project_fk` - —Å–≤—è–∑—å —Å –¥–æ–∫—É–º–µ–Ω—Ç–∞–º–∏

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –î–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö:
- **contractors**: 1 –∑–∞–ø–∏—Å—å
- **projects**: 1 –∑–∞–ø–∏—Å—å  
- **qualification_objects**: 2 –∑–∞–ø–∏—Å–∏

### –ü—Ä–∏–º–µ—Ä—ã –æ–±—ä–µ–∫—Ç–æ–≤:
1. **–ü–æ–º–µ—â–µ–Ω–∏–µ "–°–∫–ª–∞–¥"**:
   - –¢–∏–ø: –ø–æ–º–µ—â–µ–Ω–∏–µ
   - –ü–ª–æ—â–∞–¥—å: 200.00 –º¬≤
   - –ö–ª–∏–º–∞—Ç–∏—á–µ—Å–∫–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞: –ë—Ä–∏–∑ 34
   - –ü–ª–∞–Ω: –∑–∞–≥—Ä—É–∂–µ–Ω

2. **–•–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ "–•–ö-32"**:
   - –¢–∏–ø: —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫
   - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å: –ê—Ç–ª–∞–Ω—Ç
   - –°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä: 1897-9874-0023
   - –ò–Ω–≤–µ–Ω—Ç–∞—Ä–Ω—ã–π –Ω–æ–º–µ—Ä: 0023
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–æ–∫: 4
   - –ó–æ–Ω—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è: 1 –∑–æ–Ω–∞ —Å 2 —É—Ä–æ–≤–Ω—è–º–∏

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é

### 1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
```sql
-- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ database_optimization_correct.sql
-- –≤ Supabase SQL Editor
```

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∂–µ—Ç:
- –°–æ–∑–¥–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Ç–∞–±–ª–∏—Ü–∞–º
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
- –°–ª–µ–¥–∏—Ç–µ –∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
- –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ç–∞–±–ª–∏—Ü

## ‚ö° –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- **–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫** –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—è–º –∏ –∞–¥—Ä–µ—Å–∞–º –æ–±—ä–µ–∫—Ç–æ–≤
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** –ø–æ –∫–æ–Ω—Ç—Ä–∞–≥–µ–Ω—Ç–∞–º –∏ —Ç–∏–ø–∞–º
- **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è** –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º –∏ –¥–∞—Ç–∞–º
- **–ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø** –∫ JSONB –¥–∞–Ω–Ω—ã–º

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç—Ä–∏–≥—Ä–∞–º–º** –¥–ª—è –Ω–µ—á–µ—Ç–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
- **–ß–∞—Å—Ç–∏—á–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞
- **GIN –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è JSONB –ø–æ–ª–µ–π
- **–°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

## üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### 1. –†–µ–≥—É–ª—è—Ä–Ω–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ:
```sql
-- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
ANALYZE;

-- –û—á–∏—Å—Ç–∫–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
VACUUM ANALYZE;
```

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–Ω–¥–µ–∫—Å–æ–≤:
```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
SELECT 
    schemaname,
    tablename,
    indexname,
    idx_scan,
    idx_tup_read,
    idx_tup_fetch
FROM pg_stat_user_indexes 
WHERE schemaname = 'public'
ORDER BY idx_scan DESC;
```

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ EXPLAIN ANALYZE –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø–ª–∞–Ω–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤
- –°–ª–µ–¥–∏—Ç–µ –∑–∞ –º–µ–¥–ª–µ–Ω–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
- –û–±–Ω–æ–≤–ª—è–π—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ—Å–ª–µ –±–æ–ª—å—à–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–∞–Ω–Ω—ã—Ö

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∫—Ä–∏–ø—Ç `database_optimization_correct.sql` —Å–æ–∑–¥–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ **—Ä–µ–∞–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã** –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ —É—á–∏—Ç—ã–≤–∞–µ—Ç:

- ‚úÖ –í—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–ª–æ–Ω–∫–∏
- ‚úÖ –†–µ–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
- ‚úÖ –°–ø–µ—Ü–∏—Ñ–∏–∫—É JSONB –ø–æ–ª–µ–π
- ‚úÖ –ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

–¢–µ–ø–µ—Ä—å –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏! üéâ





