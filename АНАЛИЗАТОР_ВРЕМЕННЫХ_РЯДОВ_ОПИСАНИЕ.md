# Анализатор временных рядов - Описание функциональности

## Обзор

Анализатор временных рядов - это компонент системы Microclimat Analyzer, предназначенный для анализа данных температурных и влажностных измерений, полученных от логгеров данных в процессе квалификационных испытаний.

## Основные возможности

### 1. Загрузка и обработка данных
- **Поддержка форматов файлов**: `.vi2` (файлы логгеров Testo)
- **Автоматическое определение типа устройства**: Testo 174H (двухканальный), Testo 174T (одноканальный)
- **Парсинг бинарных данных**: Извлечение температурных и влажностных измерений
- **Валидация данных**: Проверка корректности измерений и фильтрация некорректных записей

### 2. Визуализация данных
- **Временные графики**: Отображение температуры и влажности во времени
- **Интерактивные графики**: Возможность масштабирования и навигации по временной шкале
- **Множественные серии данных**: Одновременное отображение данных с разных датчиков
- **Цветовое кодирование**: Различные цвета для разных зон измерения и типов датчиков

### 3. Анализ соответствия критериям
- **Настраиваемые пороги**: Установка допустимых диапазонов температуры и влажности
- **Автоматическая оценка**: Определение соответствия/несоответствия критериям
- **Статистические показатели**: Расчет процента времени в допустимых диапазонах
- **Визуальные индикаторы**: Цветовая индикация соответствия на графиках

### 4. Экспорт и отчетность
- **Генерация отчетов**: Создание PDF отчетов с графиками и анализом
- **Экспорт данных**: Сохранение обработанных данных в различных форматах
- **Шаблоны отчетов**: Настраиваемые шаблоны для различных типов испытаний

## Технические детали

### Архитектура компонентов

#### TimeSeriesAnalyzer
- **Назначение**: Основной компонент анализатора
- **Функции**: 
  - Загрузка и парсинг файлов
  - Управление состоянием данных
  - Координация работы подкомпонентов

#### TimeSeriesChart
- **Назначение**: Визуализация временных рядов
- **Технологии**: D3.js для создания интерактивных графиков
- **Возможности**:
  - Масштабирование и панорамирование
  - Отображение множественных серий
  - Интерактивные подсказки

#### VI2Parser
- **Назначение**: Парсинг файлов формата .vi2
- **Алгоритмы**:
  - Определение типа устройства по структуре файла
  - Извлечение метаданных (время начала, интервал измерений)
  - Декодирование бинарных данных измерений

#### Testo174HBinaryParser / Testo174TBinaryParser
- **Назначение**: Специализированные парсеры для конкретных моделей
- **Особенности**:
  - Оптимизированные алгоритмы для каждой модели
  - Обработка специфичных форматов данных
  - Валидация и очистка данных

### Алгоритмы обработки данных

#### 1. Определение типа устройства
```typescript
// Псевдокод алгоритма
function detectDeviceType(buffer: Buffer): DeviceType {
  // Проверка сигнатур в заголовке файла
  if (hasTesto174HSignature(buffer)) return 'testo174h';
  if (hasTesto174TSignature(buffer)) return 'testo174t';
  
  // Анализ структуры данных
  const recordSize = analyzeRecordStructure(buffer);
  if (recordSize === 174H_RECORD_SIZE) return 'testo174h';
  if (recordSize === 174T_RECORD_SIZE) return 'testo174t';
  
  return 'unknown';
}
```

#### 2. Парсинг измерений
```typescript
// Псевдокод алгоритма парсинга
function parseMeasurements(buffer: Buffer, deviceType: DeviceType): Measurement[] {
  const measurements: Measurement[] = [];
  const dataStart = findDataStart(buffer);
  const recordSize = getRecordSize(deviceType);
  
  for (let offset = dataStart; offset < buffer.length; offset += recordSize) {
    const record = buffer.slice(offset, offset + recordSize);
    const measurement = parseRecord(record, deviceType);
    
    if (isValidMeasurement(measurement)) {
      measurements.push(measurement);
    }
  }
  
  return measurements;
}
```

#### 3. Валидация данных
- **Проверка диапазонов**: Температура (-50°C до +100°C), влажность (0-100%)
- **Проверка логики**: Влажность не может превышать 100% при любой температуре
- **Фильтрация выбросов**: Удаление явно некорректных значений
- **Интерполяция**: Заполнение пропусков в данных

### Интеграция с системой

#### Связь с базой данных
- **Сохранение результатов**: Запись обработанных данных в таблицы `logger_data_summary` и `logger_data_records`
- **Связь с проектами**: Привязка данных к конкретным проектам квалификации
- **Метаданные**: Сохранение информации о файлах, времени обработки, параметрах анализа

#### API взаимодействие
```typescript
// Пример API для сохранения данных
interface LoggerDataService {
  saveLoggerData(projectId: string, data: ParsedFileData): Promise<void>;
  getLoggerDataSummary(projectId: string, objectId: string): Promise<LoggerDataSummary[]>;
  getLoggerDataRecords(projectId: string, objectId: string): Promise<LoggerDataRecord[]>;
}
```

## Пользовательский интерфейс

### Основные экраны

#### 1. Экран загрузки файлов
- **Drag & Drop**: Перетаскивание файлов для загрузки
- **Прогресс-бар**: Отображение процесса обработки
- **Предварительный просмотр**: Показ метаданных файла перед обработкой

#### 2. Экран анализа
- **Панель управления**: Настройка параметров анализа
- **Графическая область**: Отображение временных рядов
- **Панель статистики**: Показ ключевых показателей

#### 3. Экран отчетов
- **Генератор отчетов**: Создание PDF документов
- **Настройки экспорта**: Выбор форматов и параметров
- **Предварительный просмотр**: Просмотр отчета перед сохранением

### Интерактивные элементы

#### Графики
- **Масштабирование**: Колесико мыши для изменения масштаба
- **Панорамирование**: Перетаскивание для навигации по времени
- **Выделение**: Клик для получения детальной информации
- **Легенда**: Переключение видимости серий данных

#### Панели управления
- **Слайдеры**: Настройка временных диапазонов
- **Чекбоксы**: Включение/выключение серий данных
- **Выпадающие списки**: Выбор параметров анализа

## Производительность и оптимизация

### Обработка больших файлов
- **Потоковая обработка**: Обработка данных по частям для экономии памяти
- **Индексация**: Создание индексов для быстрого доступа к данным
- **Кэширование**: Сохранение промежуточных результатов

### Оптимизация графиков
- **Агрегация данных**: Уменьшение количества точек для отображения
- **LOD (Level of Detail)**: Различная детализация в зависимости от масштаба
- **Виртуализация**: Отображение только видимых элементов

## Безопасность и надежность

### Валидация входных данных
- **Проверка формата файлов**: Валидация заголовков и структуры
- **Ограничения размера**: Защита от загрузки слишком больших файлов
- **Санитизация данных**: Очистка от потенциально опасного содержимого

### Обработка ошибок
- **Graceful degradation**: Продолжение работы при частичных ошибках
- **Детальное логирование**: Запись всех операций для отладки
- **Восстановление**: Автоматическое восстановление после сбоев

## Планы развития

### Краткосрочные улучшения
- **Поддержка новых форматов**: Добавление поддержки других типов логгеров
- **Улучшенная визуализация**: Более интерактивные и информативные графики
- **Автоматические отчеты**: Генерация отчетов по расписанию

### Долгосрочные цели
- **Машинное обучение**: Использование ML для выявления аномалий
- **Облачная интеграция**: Синхронизация с облачными сервисами
- **Мобильное приложение**: Версия для мобильных устройств

## Заключение

Анализатор временных рядов представляет собой мощный инструмент для анализа данных квалификационных испытаний, обеспечивающий высокую точность обработки, интуитивный пользовательский интерфейс и надежную интеграцию с общей системой Microclimat Analyzer.




















